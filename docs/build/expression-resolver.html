<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>ExpressionResolver의 동작방식</title>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/styles/default.min.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
		<style>
			* {
				box-sizing: border-box;
			}

			html, body {
				margin: 0;
				padding: 0;
			}

			body {
				padding: 0; 
				margin: 0;
				font: 16px Roboto, sans-serif;
				font-weight: 400;
				-webkit-font-smoothing: antialiased;
				color: #5f6368;
				line-height: 1.5;
				word-break: normal;
				overflow-wrap: break-word;
			}

			h1, h2, h3, h4, h5, h6 {
				font-weight: 400;
				line-height: 1.2;
			}

			h1, h2, h3, h4, h5, h6, a, b, strong, input, textarea, th, .katex {
				color: #202124;
			}

			img {
				max-width: 100%;
			}

			pre, code {
				font-family: 'Roboto Mono', monospace;
				background-color: rgba(0,0,0,.05);
				white-space: pre-wrap;
				word-break: break-all;
				tab-size: 4;
			}

			pre {
				padding: 6px;
			}

			code {
				font-size: .85em;
			}

			pre code {
				background-color: unset;
			}

			p {
				margin: 0;
			}

			p + p {
				margin-top: 1em;
			}

			li p {
				margin-top: 1em;
				margin-bottom: 1em;
			}

			ul, ol {
				margin: 1em 0;
			}

			table {
				margin: 1em 0;
				border-collapse: collapse;
			}

			table tr td {
				border: 1px #ccc solid;
				padding: .3em;
			}

			kbd {
				font: .85em 'Roboto Mono', monospace;
				color: #202124;
				border: 1px #ccc solid;
				padding: .1em;
				border-radius: .2em;
			}

			blockquote {
				margin: 1em 0;
				padding: .5em 20px;
				border-left: 5px #202124 solid;
				background-color: #f7f7f7;
			}

			#toc {
				position: fixed;
				z-index: 1;
				overflow-y: auto;
				top: 0;
				left: 0;
				bottom: 0;
				width: 280px;
				height: 100%;
				background-color: #f1f1f1;
				padding-bottom:100px;
			}

			#toc > div {
				display: block;
				text-align: center;
				background-color: #263238;
				padding: 1.5em;
			}

			#toc > div button {
				background: none;
				border: none;
				vertical-align: middle;
				display: none;
			}

			#toc > div a {
				color: white;
				text-decoration: none;
			}

			#toc ol {
				padding: 0;
				margin: 0;
			}

			#toc > ol {
				background-color: #f1f1f1;
			}

			#toc ol li {
				list-style: none;
			}

			#toc ol li a {
				display: block;
				padding: .5em;
				text-decoration: none;
			}

			#toc ol li a:hover {
				background-color: rgba(0, 0, 0, .12);
			}

			#toc ol li ol {
				padding: 0;
				margin: 0;
				background-color: rgba(0, 0, 0, .08);
				font-size: .85em;
			}

			#toc ol li ol li {
				list-style: none;
			}

			#content {
				margin-left: 280px;
				padding: 1em;
				padding-top: 30px;
				padding-bottom: 150px;
			}

			@media screen and (max-width: 800px) {
				#toc {
					position: fixed;
					width: 100%;
					top: 0;
					border-bottom: 1px #ccc solid;
				}

				#toc:not(.toc-expanded) {
					bottom: unset;
					height: unset;
					padding-bottom: 0;
					box-shadow: 0 0 2px 0 rgba(0,0,0,.16), 0 0 0 1px rgba(0,0,0,.08);
				}

				#toc.toc-expanded .toc-on-folded {
					display: none;
				}

				#toc:not(.toc-expanded) .toc-on-expanded {
					display: none;
				}

				#toc > div {
					padding: 1em;
					text-align: left;
					height: 60px;
				}

				#toc > div button {
					display: inline-block;
					margin-right: 1em;
				}

				#content {
					margin-left: 0;
					margin-top: 60px;
				}
			}
		</style>
		<style>
			.m42kup-error {
				color: red;
				border: 1px red solid;
				padding: 0 .2em;
			}

			blockquote.m42kup-bq-info {
				border-left-color: #1976d2;
			    background-color: #e3f2fd;
			    color: #1976d2;
			}

			blockquote.m42kup-bq-info a {
			    color: #1976d2;
			    font-weight: bold;
			}

			blockquote.m42kup-bq-info::before {
				content: url('data:image/svg+xml,%0A%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%231976d2"%3E%3Cpath d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/%3E%3C/svg%3E');
				display: inline-block;
			    width: 24px;
			    height: 24px;
			    float: left;
			    margin-right: .5em;
			}

			blockquote.m42kup-bq-warn {
				border-left-color: #d32f2f;
				background-color: #ffebee;
				color: #d32f2f;
			}

			blockquote.m42kup-bq-warn a {
			    color: #d32f2f;
			    font-weight: bold;
			}

			blockquote.m42kup-bq-warn::before {
				content: url('data:image/svg+xml,%0A%3Csvg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%23d32f2f"%3E%3Cpath d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/%3E%3C/svg%3E');
			    display: inline-block;
			    width: 24px;
			    height: 24px;
			    float: left;
			    margin-right: .5em;
			}
		</style>
	</head>
	<body>
		<div id="toc">
			<div>
						<button id="toc-fold-toggle">
							<svg class="toc-on-folded" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
							<svg class="toc-on-expanded" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
						</button>
						<a href="./index.html">math-o-matic 설명서</a>
					</div>
					<ol class="toc-on-expanded"><li><div><a href="./theory.html">이론적 배경</a></div></li><li><div><a href="./precedence.html">우선순위</a></div></li><li><div><a href="./expression-resolver.html">ExpressionResolver의 동작방식</a></div></li></ol>
		</div>
		<div id="content">
			
				<h1><code>ExpressionResolver</code>의 동작방식</h1><h2><code>expand0FuncallOnce(expr0)</code></h2><p>funcall을 한 단계만 푼다. fun이 funcall이면 그것을 <code>expand0FuncallOnce</code> 한다. fun이 funcall이고 fun의 fun이 funcall이면 그것을 <code>expand0FuncallOnce</code> 한다. 등등.</p><table><tr><td><p>
	변환 전 </p></td><td><p> 변환 후 </p></td></tr><tr><td><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>↦</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x \mapsto f(x))(y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> </p></td><td><p> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> </p></td></tr><tr><td><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>↦</mo><mi>y</mi><mo>↦</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x \mapsto y \mapsto f(x, y))(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7054400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> </p></td><td><p> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>↦</mo><mi>f</mi><mo stretchy="false">(</mo><mi>z</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y \mapsto f(z, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7054400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> </p></td></tr><tr><td><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>↦</mo><mi>y</mi><mo>↦</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x \mapsto y \mapsto f(x, y))(z)(w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7054400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span> </p></td><td><p> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>y</mi><mo>↦</mo><mi>f</mi><mo stretchy="false">(</mo><mi>z</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(y \mapsto f(z, y))(w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span> </p></td></tr><tr><td><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>↦</mo><mi>y</mi><mo>↦</mo><mi>z</mi><mo>↦</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>u</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x \mapsto y \mapsto z \mapsto f(x, y, z))(w)(v)(u)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7054400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.522em;vertical-align:-0.011em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mclose">)</span></span></span></span> </p></td><td><p> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>y</mi><mo>↦</mo><mi>z</mi><mo>↦</mo><mi>f</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>u</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(y \mapsto z \mapsto f(w, y, z))(v)(u)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.522em;vertical-align:-0.011em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mclose">)</span></span></span></span>
</p></td></tr></table><h3>알고리즘</h3><ol><li><p> expr0이 funcall이 아닌 경우 에러.
	</p></li><li><p> expr0.fun이 funcall일 경우 expr0.fun을 expand0FuncallOnce 한 expr0 반환.
	</p></li><li><p> expr0.fun이 본체가 없을 경우 에러.
	</p></li><li><p> expr0.fun의 본체에서 expr0.fun의 매개변수를 expr0의 인자로 substitute0한 것을 반환.
</p></li></ol><h2><code>equals0(a, b)</code></h2><p>두 expr0(funcall / fun / typevar) 표현식 a, b의 구조가 같은지를 판단한다.</p><h3>알고리즘</h3><ol><li><p> a, b가 funcall인 경우
	</p><ol><li><p> a.fun이 funcall일 경우 <code>equals0(expand0FuncallOnce(a), b)</code> 반환.
		</p></li><li><p> b.fun이 funcall일 경우 <code>equals0(a, expand0FuncallOnce(b))</code> 반환.
		</p></li><li><p> a.fun 및 b.fun이 본체가 없을 경우
		</p><ol><li><p> <code>a.fun != b.fun</code>일 경우 false.
			</p></li><li><p> 어떤 n번째 인자 간의 equals0가 false일 경우 false.
			</p></li><li><p> true.
		</p></li></ol><p>
		</p></li><li><p> a.fun의 본체가 있을 경우 <code>equals0(expand0FuncallOnce(a), b)</code> 반환.
		</p></li><li><p> <code>equals0(a, expand0FuncallOnce(b))</code> 반환.
	</p></li></ol><p>
	</p></li><li><p> a가 funcall인 경우
	</p><ol><li><p> a.fun이 funcall일 경우 <code>equals0(expand0FuncallOnce(a), b)</code> 반환.
		</p></li><li><p> a.fun의 본체가 없을 경우 false.
		</p></li><li><p> <code>equals0(expand0FuncallOnce(a), b)</code> 반환.
	</p></li></ol><p>
	</p></li><li><p> b가 funcall인 경우
	</p><ol><li><p> b.fun이 funcall일 경우 <code>equals0(a, expand0FuncallOnce(b))</code> 반환.
		</p></li><li><p> b.fun의 본체가 없을 경우 false.
		</p></li><li><p> <code>equals0(a, expand0FuncallOnce(b))</code> 반환.
	</p></li></ol><p>
	</p></li><li><p> 타입이 다르면 false.
	</p></li><li><p> a, b가 callable 한 타입인 경우 같은 임시 변수들을 인자로 한 funcall을 만들어 이것들의 equals0을 반환.
	</p></li><li><p> <code>a == b</code> 반환.
</p></li></ol><h2><code>resolve0_(a, b, pv, iv)</code></h2><p>어떤 expr0 패턴 a와 expr0 표현식 b에 대해 b로부터 a에 있는 패턴 변수들을 추정한다. b는 패턴 변수를 포함하지 않음이 가정된다. 무엇이 패턴 변수이며 무엇이 임시 변수인지에 관한 정보는 각각 pv 및 iv를 통해 제공된다.</p><p>이때 패턴 변수는 임시 변수 또는 함수 매개변수 등 내부 변수로부터 독립적이어야 한다. <code>expand0FuncallOnce</code> 시 패턴 변수는 함수 매개변수로부터 독립적임이 가정된다. 그러므로 iv에는 임시 변수만 전달하기로 한다.</p><p>pv는 어떤 것이 패턴 변수인지와 각각이 특정되었는지 여부 및 특정되었을 경우 특정된 가능성에 관한 정보를 포함한다.</p><p>반환 값은 각각의 패턴 변수에 대하여,
</p><ol><li><p> 패턴 매칭이 불가능함이 유도된 경우: 에러.
	</p></li><li><p> 패턴 변수를 특정하지 못한 경우: falsy한 값. 불가능함을 유도할 수 없었다는 뜻이며 아무 값이나 가능하다는 뜻이 아님.
	</p></li><li><p> 패턴 변수가 하나 또는 유한 개로 특정될 경우: 배열. 길이가 0일 수 없음. 배열 중에 없으면 매칭이 불가능하다는 뜻이며 배열에 있는 아무 값이나 가능하다는 뜻이 아님. 패턴 변수 간의 종속성도 고려되지 않음.
</p></li></ol><p>resolve0_의 결과로서 패턴의 가능성을 얻은 경우, 이 가능성을 resolve0_에 다시 전달하면 가능성이 더 줄 수도 있다. 또한 가능성이 하나인 경우 이게 가능하다는 보증이 없으므로 확인해야 됨. 그러므로 가능성이 줄어들지 않을 때까지 resolve0_을 호출하고, 가능성이 하나가 되지 않았으면 오류를 던지고, 되었으면 그것을 반환하는 과정이 필요함.</p><h3>알고리즘</h3><ol><li><p> 타입이 다르면 에러.
	</p></li><li><p> a, b가 funcall인 경우
	</p><ol><li><p> a.fun이 funcall일 경우 <code>resolve0_(expand0FuncallOnce(a), b, pv, iv)</code> 반환.
		</p></li><li><p> b.fun이 funcall일 경우 <code>resolve0_(a, expand0FuncallOnce(b), pv, iv)</code> 반환.
		</p></li><li><p> a.fun이 패턴 변수일 경우
		</p><ol><li><p> 패턴 변수가 하나로 특정되었을 경우 a.fun을 특정된 표현식으로 바꾼 것의 resolve0_을 반환.
			</p></li><li><p> a의 인자가 모두 내부 변수이며 서로 다를 경우
			</p><ol><li><p> b가 a의 인자에 없는 임시 변수를 포함할 경우 a.fun이 내부 변수와 독립적이어야 하므로 에러.
				</p></li><li><p> </p><pre><code>f(x, ..., z) = b
</code></pre><p>에 대해, f를 </p><pre><code>(x&#39;, ..., z&#39;) =&gt; b[x&#39;/x, ..., z&#39;/z]
</code></pre><p>에 매칭하고 주어진 가능성과 교집합. 공집합이 발생하였으면 에러. <code>b[...]</code>는 x를 x&#39;으로 치환하고 ... z를 z&#39;으로 치환한 것이다.
			</p></li></ol><p>
			</p></li><li><p> 주어진 가능성.
		</p></li></ol><p>
		</p></li><li><p> a.fun 및 b.fun이 본체가 없을 경우
		</p><ol><li><p> <code>a.fun != b.fun</code>일 경우 에러.
			</p></li><li><p> 같은 pv, iv에 대해 n번째 인자 간의 resolve0_을 하여 그 교집합을 주어진 가능성과 교집합 한 것을 반환. 단 공집합이 된 경우 에러.
		</p></li></ol><p>
		</p></li><li><p> a.fun의 본체가 있을 경우 <code>resolve0_(expand0FuncallOnce(a), b, pv, iv)</code> 반환.
		</p></li><li><p> <code>resolve0_(a, expand0FuncallOnce(b), pv, iv)</code> 반환.
	</p></li></ol><p>
	</p></li><li><p> a가 funcall인 경우
	</p><ol><li><p> a.fun이 funcall일 경우 <code>resolve0_(expand0FuncallOnce(a), b, pv, iv)</code> 반환.
		</p></li><li><p> a.fun이 패턴 변수일 경우
		</p><ol><li><p> 패턴 변수가 하나로 특정되었을 경우 a.fun을 특정된 표현식으로 바꾼 것의 resolve0_을 반환.
			</p></li><li><p> a의 인자가 모두 내부 변수이며 서로 다를 경우
			</p><ol><li><p> b가 a의 인자에 없는 임시 변수를 포함할 경우 a.fun이 내부 변수와 독립적이어야 하므로 에러.
				</p></li><li><p> </p><pre><code>f(x, ..., z) = b
</code></pre><p>에 대해, f를 </p><pre><code>(x&#39;, ..., z&#39;) =&gt; b[x&#39;/x, ..., z&#39;/z]
</code></pre><p>에 매칭하고 주어진 가능성과 교집합. 공집합이 발생하였으면 에러. <code>b[...]</code>는 x를 x&#39;으로 치환하고 ... z를 z&#39;으로 치환한 것이다.
			</p></li></ol><p>
			</p></li><li><p> 주어진 가능성.
		</p></li></ol><p>
		</p></li><li><p> a.fun의 본체가 없을 경우 에러.
		</p></li><li><p> <code>resolve0_(expand0FuncallOnce(a), b, pv, iv)</code> 반환.
	</p></li></ol><p>
	</p></li><li><p> a가 패턴 변수인 경우
	</p><ol><li><p> 패턴 변수가 하나로 특정되었을 경우 특정된 표현식과 b의 resolve0_을 반환.
		</p></li><li><p> b가 a에 없는 임시 변수를 포함할 경우 a가 내부 변수와 독립적이어야 하므로 에러.
		</p></li><li><p> a를 b에 매칭하고 주어진 가능성과 교집합. 단 공집합이 발생하였으면 에러.
	</p></li></ol><p>
	</p></li><li><p> b가 funcall인 경우
	</p><ol><li><p> b.fun이 funcall일 경우 <code>resolve0_(a, expand0FuncallOnce(b), pv, iv)</code> 반환.
		</p></li><li><p> b.fun의 본체가 없을 경우 에러.
		</p></li><li><p> <code>resolve0_(a, expand0FuncallOnce(b), pv, iv)</code> 반환.
	</p></li></ol><p>
	</p></li><li><p> a, b가 callable 한 타입인 경우 같은 임시 변수들을 인자로 한 funcall을 만들어 이것들의 resolve0_을 반환하는데, iv에 이 임시 변수들을 추가하여 호출함.
	</p></li><li><p> <code>a != b</code>이면 에러.
	</p></li><li><p> 주어진 가능성.
</p></li></ol><h2><code>resolve1_(a, b, pv, iv)</code></h2><p>resolve0_과 비슷하나 expr1을 비교한다. a는 ... 구문이나 @|- 구문 등을 사용할 수 있다. a 및 b는 rule 또는 tee여야 한다.</p><p>...의 가능성에 관한 정보도 반환해야 하겠다.</p><h3>알고리즘</h3><ol><li><p> rule인지 tee인지 여부가 다르면 에러.
	</p></li><li><p> a 및 b가 rule인 경우
	</p><ol><li><p> 입력항 타입이 다르면 에러.
		</p></li><li><p> 같은 임시 변수들을 인자로 한 rulecall을 만들어 이것들을 expr1 레벨에서 expand 한 것의 resolve1_을 반환하는데, iv에 이 임시 변수들을 추가하여 호출함.
	</p></li></ol><p>
	</p></li><li><p> a 및 b가 tee인 경우
	</p><ol><li><p> a가 permutation을 허용하지 않을 경우
		</p><ol><li><p> antecedent의 개수를 일치시킬 수 없을 경우, 즉 ...이 없고 개수가 다르거나 ...이 있고 b의 개수가 작을 경우 에러.
			</p></li><li><p> antecedent를 순서대로 resolve0_ 하고(단 ...의 경우 b 측에 임시 변수가 있으면 에러. 아니면 주어진 가능성) consequent도 해서 교집합 반환. 단 공집합이 발생하였으면 에러.
		</p></li></ol><p>
		</p></li><li><p> a가 permutation을 허용할 경우
		</p><ol><li><p> antecedent의 개수를 일치시킬 수 없을 경우, 즉 ...이 없고 개수가 다르거나 ...이 있고 b의 개수가 작을 경우 에러.
			</p></li><li><p> 가능한 모든 antecedent의 조합에 대하여(a, b의 ...을 제외한 antecedent의 개수 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span>에 대하여 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>b</mi></msub><msub><mi mathvariant="normal">P</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">{}_b\mathrm P_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>개가 있다)
			</p><ul><li><p> antecedent를 순서대로 resolve0_ 하고(단 ...의 경우 b 측에 임시 변수가 있으면 에러. 아니면 주어진 가능성) consequent도 해서 교집합 반환. 단 공집합이 발생하였으면 에러.
			</p></li></ul><p>
			하되, 에러가 발생하였으면 catch 후 무시하고, 에러가 발생하지 않은 것들을 합집합. 단 전부 에러거나 공집합일 경우 에러.
		</p></li></ol><p>
	</p></li></ol><p>
</p></li></ol><h2><code>resolve1s_(a, b, pv, iv)</code></h2><p>resolve1_과 비슷하나 expr1 여러 개를 비교한다.</p><p>...1, ...2 등의 가능성에 관한 정보도 반환해야 하겠다.</p><h3>알고리즘</h3><ol><li><p> 개수가 다르면 에러.
	</p></li><li><p> 각각에 대해 resolve1_ 하고 교집합 반환. 단 공집합이면 에러.
</p></li></ol><h2><code>resolve1s(a, b, pv, iv)</code></h2><h3>알고리즘</h3><ol><li><p> 결과가 변하지 않음이 확인될 때까지 resolve1s_의 결과를 pv에 넣어서 resolve1s_ 호출.
	</p></li><li><p> 가능성이 하나가 아니면 에러.
	</p></li><li><p> 가능성이 작동함은 이미 검증되었으므로 매치된 값 반환.
</p></li></ol>
			
		</div>
		<script>
			$ = (q, n) => (n || document).querySelector(q);

			var expanded = false;

			function applyExpandedState(expanded) {
				if (expanded) {
					$('#toc').classList.add('toc-expanded');
					$('#content').classList.add('toc-expanded');
				} else {
					$('#toc').classList.remove('toc-expanded');
					$('#content').classList.remove('toc-expanded');
				}
			}

			applyExpandedState(expanded);

			$('#toc-fold-toggle').addEventListener('click', _ => {
				expanded = !expanded;

				applyExpandedState(expanded);
			});
		</script>
	</body>
</html>