<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>math-o-matic</title>
		<script src="../dist/math-o-matic.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/m42kup@0.3.0/dist/m42kup.min.js"></script>
		<script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/codemirror@5.57.0/lib/codemirror.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/codemirror@5.57.0/keymap/sublime.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/codemirror@5.57.0/addon/hint/show-hint.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/codemirror@5.57.0/addon/display/placeholder.js"></script>
		<script>
			m42kup.set({
				katex
			});

			$ = (q, n) => (n || document).querySelector(q);
			$$ = (q, n) => (n || document).querySelectorAll(q);

			var escapeHtml = s => (s + '').replace(/[&<>"']/g, m => ({
					'&': '&amp;', '<': '&lt;', '>': '&gt;',
					'"': '&quot;', "'": '&#39;'
			})[m]);
		</script>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.57.0/lib/codemirror.min.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.57.0/addon/hint/show-hint.min.css">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<nav>
			<a href="#top" style="color: #222; font-size: 2em; text-decoration: none;">ğ•¸</a>
			<div id="whatever">
				<input id="search-input" type="text" placeholder="Search (S)" class="mono" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
				<button id="reload" title="reload (R)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#222" width="24px" height="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg></button>
				<button id="button-show-console" title="console (C/F7)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#222" width="24px" height="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg></button>
				<div id="search-dropdown" class="mono" style="display: none;">
					<ul></ul>
				</div>
			</div>
			<script>
				var nmax = 10;
	
				function getList(keyword, inputBefore, list) {
					keyword = keyword.toLowerCase().trim();
	
					if (!keyword || keyword == '$') return [];
	
					return (
							keyword.startsWith('$')
								? [...new Set(inputBefore.match(/\$?[a-z0-9_]*/gi))]
								: list
						)
						.map(name => {
							var lowername = name.toLowerCase();
	
							var pname = 0;
							var matchptrs = [];
	
							for (var pval = 0; pval < keyword.length; pval++) {
								if (pname >= name.length) return false;
								
								while (lowername[pname] != keyword[pval]) {
									pname++;
									if (pname >= name.length) return false;
								}
	
								matchptrs.push(pname);
								pname++;
							}
	
							return {
								name,
								match: matchptrs
							};
						})
						.filter(e => e)
						.sort((a, b) => {
							for (var i = 0; i < a.match.length; i++) {
								if (a.match[i] != b.match[i])
									return a.match[i] - b.match[i];
							}
	
							return a.name.localeCompare(b.name);
						})
						.slice(0, nmax);
				}
				
				(() => {
	
				function show() {
					$dropdown.style.display = 'block';
					$input.select();
				}
	
				function dismiss() {
					$dropdown.style.display = 'none';
					$input.blur();
				}
	
				function destroy() {
					dismiss();
					$input.value = '';
					selected = false;
					list = [];
					$('ul', $dropdown).innerHTML = '';
				}
	
				hotkeys('s', (evt, handler) => {
					evt.preventDefault();
					$input.focus();
				});
	
				var $input = $('#search-input'),
					$dropdown = $('#search-dropdown');
				
				var selected = false,
					list = [];
	
				$input.addEventListener('focus', evt => {
					show();
				});
	
				document.addEventListener('click', evt => {
					if (evt.target == $input || evt.target.closest('#search-dropdown')) return;
	
					dismiss();
				})
				
				$input.addEventListener('input', evt => {
					var v = $input.value;
					var $el = $('ul', $dropdown);
					var html = '';
	
					list = [];
	
					getList(v, '', searchDatabase).forEach(({name, match}, i) => {
						if (i == 0) selected = 0;
	
						html += `<li${i == 0 ? ' class="selected"' : ''}><a href="#def-${name}">`
							+ name.split('').map((e, i) => {
							return match.includes(i) ? `<b>${e}</b>` : e;
						}).join('') + '</a></li>';
	
						list.push(name);
					});
	
					$el.innerHTML = html;
	
					[].forEach.call($$('a', $el), $ => {
						$.addEventListener('click', evt => { destroy() });
					});
				});
	
				$input.addEventListener('keydown', evt => {
					if (evt.key == 'Enter') {
						evt.preventDefault();
						if (!list[selected]) return;
	
						location.href = '#def-' + list[selected];
						destroy();
					}
	
					if (evt.key == 'Escape') {
						evt.preventDefault();
						dismiss();
					}
	
					if (['ArrowDown', 'ArrowUp', 'Tab'].includes(evt.key)) {
						var direction = evt.key == 'Tab'
							? evt.shiftKey ? -1 : 1
							: evt.key == 'ArrowUp' ? -1 : 1;
	
						evt.preventDefault();
	
						var len = list.length;
						if (len <= 0) {
							selected = false;
							return;
						}
	
						selected = (selected + direction + len) % len;
	
						[].map.call($$('li', $dropdown), ($, i) => {
							$.classList[i == selected ? 'add' : 'remove']('selected');
						});
					}
				});
				
				})();
			</script>
		</nav>
		<h1 id="top">math-o-matic</h1>
		<a href="https://github.com/logico-philosophical/math-o-matic" style="text-decoration: none;"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTggMEMzLjU4IDAgMCAzLjU4IDAgOGMwIDMuNTQgMi4yOSA2LjUzIDUuNDcgNy41OS40LjA3LjU1LS4xNy41NS0uMzggMC0uMTktLjAxLS44Mi0uMDEtMS40OS0yLjAxLjM3LTIuNTMtLjQ5LTIuNjktLjk0LS4wOS0uMjMtLjQ4LS45NC0uODItMS4xMy0uMjgtLjE1LS42OC0uNTItLjAxLS41My42My0uMDEgMS4wOC41OCAxLjIzLjgyLjcyIDEuMjEgMS44Ny44NyAyLjMzLjY2LjA3LS41Mi4yOC0uODcuNTEtMS4wNy0xLjc4LS4yLTMuNjQtLjg5LTMuNjQtMy45NSAwLS44Ny4zMS0xLjU5LjgyLTIuMTUtLjA4LS4yLS4zNi0xLjAyLjA4LTIuMTIgMCAwIC42Ny0uMjEgMi4yLjgyLjY0LS4xOCAxLjMyLS4yNyAyLS4yNy42OCAwIDEuMzYuMDkgMiAuMjcgMS41My0xLjA0IDIuMi0uODIgMi4yLS44Mi40NCAxLjEuMTYgMS45Mi4wOCAyLjEyLjUxLjU2LjgyIDEuMjcuODIgMi4xNSAwIDMuMDctMS44NyAzLjc1LTMuNjUgMy45NS4yOS4yNS41NC43My41NCAxLjQ4IDAgMS4wNy0uMDEgMS45My0uMDEgMi4yIDAgLjIxLjE1LjQ2LjU1LjM4QTguMDEzIDguMDEzIDAgMDAxNiA4YzAtNC40Mi0zLjU4LTgtOC04eiI+PC9wYXRoPjwvc3ZnPg==" style="vertical-align: middle; margin-right:.5em">GitHub repository</a> &nbsp; <a href="../docs/build/index.html" style="text-decoration: none;"><img style="vertical-align: middle;margin-right:.5em;" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNjY2Ij48cGF0aCBkPSJNMTQgMkg2Yy0xLjEgMC0xLjk5LjktMS45OSAyTDQgMjBjMCAxLjEuODkgMiAxLjk5IDJIMThjMS4xIDAgMi0uOSAyLTJWOGwtNi02em0yIDE2SDh2LTJoOHYyem0wLTRIOHYtMmg4djJ6bS0zLTVWMy41TDE4LjUgOUgxM3oiLz48L3N2Zz4=">documentation</a>
		<blockquote id="bq-note-file-scheme" style="display: none;">
			<b>ì°¸ê³ .</b> ì´ í˜ì´ì§€ëŠ” ë¡œì»¬ì—ì„œ <code>file://</code> ìŠ¤í‚´ìœ¼ë¡œ ë¡œë“œëœ ë“¯í•œë°, ì´ë•Œ CORS ì •ì±…ì— ì˜í•´ í˜ì´ì§€ê°€ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë•Œ ë‹¤ìŒê³¼ ê°™ì€ í•´ê²°ì±…ì´ ìˆìŠµë‹ˆë‹¤.</p>
			<ul>
				<li> ë¡œì»¬ ì„œë²„ë¥¼ í†µí•´ ì ‘ì†í•˜ê¸°. ì´ëŠ” npmì˜ <a href="https://www.npmjs.com/package/http-server">http-server</a> íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì—ì„œ <pre><code>npx http-server -c-1</code></pre>ë¥¼ ì‹¤í–‰í•œ í›„ í„°ë¯¸ë„ì— ì¶œë ¥ë˜ëŠ” ì£¼ì†Œë¡œ ì ‘ì†í•˜ì„¸ìš”.
				<li> Chromeì˜ ê²½ìš° <code>--allow-file-access-from-files</code> í”Œë˜ê·¸ë¥¼ í†µí•´ ë¡œì»¬ íŒŒì¼ ë¡œë“œë¥¼ ê°€ëŠ¥í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a href="https://stackoverflow.com/a/18137280">StackOverflow ë§í¬</a>
			</ul>
			<script>
				if (location.protocol == 'file:')
					$('#bq-note-file-scheme').style.display = 'block';
			</script>
		</blockquote>
		<h2>ê°œìš”</h2>
		ì´ í˜ì´ì§€ëŠ” math-o-maticìœ¼ë¡œ ë§Œë“¤ê³  ìˆëŠ” ê³µë¦¬ê³„ë¥¼ ë³´ì—¬ ì¤ë‹ˆë‹¤. í˜ì´ì§€ í•˜ë‹¨ì— ìˆëŠ” ë²„íŠ¼ ì¤‘ í•˜ë‚˜ë¥¼ ëˆŒëŸ¬ì„œ ê³µë¦¬ê³„ë¥¼ ë¡œë“œí•˜ì„¸ìš”. ì¥ì¹˜ì˜ ê³„ì‚° ì„±ëŠ¥ì— ë”°ë¼ ë§ì€ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		<h2>ìš°ìƒë‹¨ ì»¨íŠ¸ë¡¤</h2>
		<ul>
			<li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#222" width="24px" height="24px" style="vertical-align: middle;"><path d="M0 0h24v24H0z" fill="none"/><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg> ë²„íŠ¼(<kbd>R</kbd>)ì€ íŒŒì¼ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ì„œ ëª©ë¡ì„ ì¬ì‘ì„±í•©ë‹ˆë‹¤. ë‹¨ ê·¸ ê³¼ì •ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ì„ ê²½ìš° ì´ì „ ëª©ë¡ì„ ë³´ì¡´í•©ë‹ˆë‹¤.
			<li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#222" width="24px" height="24px" style="vertical-align: middle;"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg> ë²„íŠ¼(<kbd>C</kbd> ë˜ëŠ” <kbd>F7</kbd>)ì€ ì½˜ì†”ì„ ì—¬ë‹«ìœ¼ë©° ì½˜ì†”ì€ REPL ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
			<ul>
				<li><kbd>Shift</kbd> + <kbd>Enter</kbd>: ì œì¶œ</li>
				<li><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Enter</kbd>: ì…ë ¥ì„ ì§€ìš°ì§€ ì•Šê³  ì œì¶œ</li>
				<li><kbd>Ctrl</kbd> + <kbd>L</kbd>: ì½˜ì†” ê¸°ë¡ ì§€ìš°ê¸°</li>
			</ul>
			ì´ì™¸ì—ë„ <a href="https://codemirror.net/">CodeMirror</a>ì˜ <a href="https://codemirror.net/demo/sublime.html">sublime í‚¤ë§µ</a>ì—ì„œ ì œê³µí•˜ëŠ” ë‹¨ì¶•í‚¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		</ul>
		<h2>ì°¸ì¡°</h2>
		<ul>
			<li>[Pinter]: Pinter, C. <i>A Book of Set Theory.</i> Dover Books on Mathematics. Dover Publications, 2014.</li>
		</ul>
		<h2>ì—°ì‚°ì ìš°ì„ ìˆœìœ„</h2>
		<div id="precedence">[ë¡œë“œí•˜ì„¸ìš”]</div>
		<h2>ëª©ë¡</h2>
		<div id="list"></div>
		<div id="summary"></div>
		<div id="all"></div>
		<div class="console-wrap-wrap" style="display:none">
			<div class="console-wrap">
				<div id="console-display-wrap">
					<table id="console-display" style="margin: 0"></table>
				</div>
			</div>
		</div>
		<script src="./console.js"></script>
		<script>
			var program = null;
			
			var katexOpts = {
				trust: context => {
					if (context.command == '\\href'
							&& context.protocol == '_relative')
						return true;
					
					if (['\\htmlId', '\\htmlData'].includes(context.command))
						return true;
					
					return false;
				},
				strict: (errorCode, errorMsg, token) => {
					if (errorCode == 'htmlExtension') return 'ignore';
					return 'warn';
				}
			}

			var ktx = s => {
				var ret = '';
				try {
					ret = katex.renderToString(s, katexOpts);
				} catch (e) {
					console.error(`Error parsing ${s}`);
					throw Error(e);
				}

				return ret;
			}

			var fileList = [
				['propositional', 'ëª…ì œë…¼ë¦¬'],
				['predicate', 'ìˆ ì–´ë…¼ë¦¬'],
				['set', 'ì§‘í•©ë¡ '],
				['relation', 'ì´í•­ê´€ê³„'],
				['function', 'í•¨ìˆ˜'],
				['algebra', 'ëŒ€ìˆ˜í•™'],
				['natural', 'ìì—°ìˆ˜ ì§‘í•©'],
				['integer', 'ì •ìˆ˜ ì§‘í•©']
			];

			var filename = null;

			$('#list').innerHTML = fileList.map(([k, v]) => {
				return `<input type="button" value="${v}" style="border:1px #222 solid" onclick="filename='${k}';reload()"> `;
			}).join('');

			var expansionList = [];

			function generateHtml() {
				console.log('--- HTML GENERATION START ---');
				var start = new Date(), end;

				var precedenceMap = new Map();

				var primitiveTypeList = [],
					macroTypeList = [],
					primitiveDefinitionList = [],
					macroDefinitionList = [],
					axiomSchemaList = [],
					notProvedList = [],
					provedList = [];
				
				var ret = '';

				function foo(scope) {
					var map = {};

					for (var [k, v] of scope.defMap) {
						var prec = v.precedence;
						if (prec) {
							if (precedenceMap.has(prec)) {
								precedenceMap.set(prec, precedenceMap.get(prec).concat([k]));
							} else {
								precedenceMap.set(prec, [k]);
							}	
						}
					}

					primitiveTypeList = primitiveTypeList.concat(
						[...scope.typedefMap]
							.filter(([k, v]) => !v.expr).map(([k, v]) => k)
					);

					macroTypeList = macroTypeList.concat(
						[...scope.typedefMap]
							.filter(([k, v]) => v.expr).map(([k, v]) => k)
					);

					primitiveDefinitionList = primitiveDefinitionList.concat(
						[...scope.defMap]
							.filter(([k, v]) => !v.expr).map(([k, v]) => k)
					);

					macroDefinitionList = macroDefinitionList.concat(
						[...scope.defMap]
							.filter(([k, v]) => v.expr).map(([k, v]) => k)
					);
					
					axiomSchemaList = axiomSchemaList.concat(
						[...scope.schemaMap]
							.filter(([k, v]) => v.schemaType == 'axiom').map(([k, v]) => k)
					);

					notProvedList = notProvedList.concat(
						[...scope.schemaMap]
							.filter(([k, v]) => !v.isProved()).map(([k, v]) => k)
					);

					provedList = provedList.concat(
						[...scope.schemaMap]
							.filter(([k, v]) => v.schemaType != 'axiom' && v.isProved()).map(([k, v]) => k)
					);

					for (var [k, v] of scope.typedefMap) {
						map[v._id] = `<div class="block">`
							+ `<p class="label"><a id="type-${k}" href="#type-${k}"><b>type</b> ${k}</a></p>`
							+ `<div class="math">${ktx(v.toTeXString(true, true))}</div>`

							+ (
								v.doc
								? '<p class="label"><b>description</b></p>'
								  + `<p class="description">${m42kup.render(v.doc)}</p>`
								: ''
							)

							+ `</div>`;
					}

					for (var [k, v] of scope.defMap) {
						map[v._id] = `<div class="block">`
							+ `<p class="label"><a id="def-${k}" href="#def-${k}"><b>${
								v.sealed ? 'sealed ' : ''
							}definition</b> ${k}</a>${!v.params
									? ': ' + v.type
									: `(${v.params.map(p => p.toSimpleString()).join(', ')})`
										+ `: ${v.type.resolve().to}`
							}</p>`
							+ `<div class="math">${ktx(v.toTeXString(true, true))}</div>`

							+ (
								v.doc
								? '<p class="label"><b>description</b></p>'
								  + `<p class="description">${m42kup.render(v.doc)}</p>`
								: ''
							)

							+ `</div>`;
					}

					for (var [k, v] of scope.schemaMap) {
						map[v._id] = `<div class="block">`
							+ `<p class="label"><a id="def-${k}" href="#def-${k}">${
								v.annotations.map(a => `<b class="red">${a}</b> `).join('')
							}<b>${v.schemaType}</b> ${k}</a>(${v.params.map(p => p.toSimpleString()).join(', ')})${
								v.context.usingList.length
									? ` <b>using</b> ${v.context.usingList.map(u => u.name).join(', ')}`
									: ''
							}</p>`
							+ `<div class="math">${ktx(v.toTeXString(true, true))}</div>`

							+ (
								v.expr
									? v.schemaType == 'axiom'
										? ''
										: '<p class="label"><b>proof explorer</b></p>'
											+ (
												expansionList.includes(k)
													? `<p>${program.getProofExplorer(k, ktx)}</p>`
													: `<p><input type="button" value="show" class="colored button-expand-proof" onclick="this.parentElement.innerHTML = program.getProofExplorer('${k}', ktx);expansionList.push('${k}');"></p>`
											)
									: ''
							)

							+ (
								v.doc
								? '<p class="label"><b>description</b></p>'
								  + `<p class="description">${m42kup.render(v.doc)}</p>`
								: ''
							)

							+ `</div>`;
					}

					ret += `<h3 class="label">${scope.fileUri} (${Object.keys(map).length})</h3><div class="block-file">`
						+ Object.keys(map).sort((l, r) => l._id - r._id).map(k => map[k]).join('')
						+ '</div>';
				}

				var printedImports = [filename];

				function bar(scope) {
					for (var [k, s] of scope.importMap) {
						if (printedImports.includes(k)) continue;
						printedImports.push(k);

						bar(s);
						foo(s);
					}
				}
				
				bar(program.scope);
				foo(program.scope);

				end = new Date();
				console.log('--- HTML GENERATION END ---');
				console.log(`HTML generation took ${end - start} ms`);
				console.log('--- HTML RENDER START ---');
				start = new Date();

				precedenceMap = [...precedenceMap].sort((a, b) => a[0] - b[0]);

				$('#precedence').innerHTML = `
				<p>í˜„ì¬ ì—°ì‚°ì ìš°ì„ ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

				<table>
					<tr><th>ìš°ì„ ìˆœìœ„</th><th>ì—°ì‚°ì</th></tr>
					${precedenceMap.map(([k, v]) => {
						return `<tr><td>${k}</td><td>${v.map(w => {
							return `<a href="#def-${w}">${w}</a>`;
						}).join(', ')}</td></tr>`;
					}).join('')}
				</table>

				<p>ìœ„ í‘œëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>`;
				
				$('#summary').innerHTML = `
				<ul>
					<li><p><b>íƒ€ì…</b>(${primitiveTypeList.length + macroTypeList.length})</p>
					<ul>
						<li><b>ì›ì‹œ íƒ€ì…</b>(${primitiveTypeList.length}): ${
							primitiveTypeList.map(n => `<a href="#type-${n}">${n}</a>`).join(', ')
						}
						<li><b>ë§¤í¬ë¡œ</b>(${macroTypeList.length}): ${
							macroTypeList.map(n => `<a href="#type-${n}">${n}</a>`).join(', ')
						}
					</ul>

					<li><p><b>ì •ì˜</b>(${primitiveDefinitionList.length + macroDefinitionList.length})</p>
					<ul>
						<li><b>ì›ì‹œ ê¸°í˜¸</b>(${primitiveDefinitionList.length}): ${
							primitiveDefinitionList.map(n => `<a href="#def-${n}">${n}</a>`).join(', ')
						}
						<li><b>ë§¤í¬ë¡œ</b>(${macroDefinitionList.length}): ${
							macroDefinitionList.map(n => `<a href="#def-${n}">${n}</a>`).join(', ')
						}
					</ul>
					
					<li><p><b>ìŠ¤í‚¤ë§ˆ</b>(${axiomSchemaList.length + notProvedList.length + provedList.length})</p>
					<ul>
						<li><b>ê³µë¦¬</b>(${axiomSchemaList.length}): ${
							axiomSchemaList.map(n => `<a href="#def-${n}">${n}</a>`).join(', ')
						}
						<li><b>ì¦ëª…ë˜ì§€ ì•ŠìŒ</b>(${notProvedList.length}): ${
							notProvedList.map(n => `<a href="#def-${n}">${n}</a>`).join(', ')
						}
						<li><b>ì •ë¦¬</b>(${provedList.length})
					</ul>
				</ul>`;

				$('#all').innerHTML = ret;

				end = new Date();
				console.log('--- HTML RENDER END ---');
				console.log(`HTML render took ${end - start} ms`);
			}

			hotkeys('r', (evt, handler) => {
				evt.preventDefault();
				reload();
			});

			document.body.addEventListener('click', evt => {
				var $a = evt.target;

				while (!($a instanceof HTMLAnchorElement)) {
					$a = $a.parentElement;

					if (!$a) return;
				}

				var match = $a.getAttribute('href').match(/^#id-[0-9]+$/);

				if (match) {
					let $el = $(match[0]);

					if ($el) {
						if ($el.classList.contains('flicker')) {
							return;
						}

						$el.classList.add('flicker');

						let listener = evt => {
							$el.removeEventListener('animationend', listener);
							$el.classList.remove('flicker');
						};
						
						$el.addEventListener('animationend', listener);
					}
				}
			});

			var reloading = false;
			var searchDatabase = [];

			async function reload() {
				if (!filename) return;
				if (reloading) return;
				reloading = true;
				$('#reload').disabled = true;
				$('#reload svg').classList.add('rotate');

				try {
					console.log('--- PROGRAM START ---');
					var start = new Date();
					program = new MathOMatic();
					await program.loadModule(filename, async filename => ({
						fileUri: `/${filename}.math`,
						code: await new Promise((resolve, reject) => {
							var xhr = new XMLHttpRequest();
							xhr.addEventListener('load', () => {
								resolve(xhr.responseText);
							});
							xhr.addEventListener('error', () => {
								reject();
							});
							xhr.open('GET', `../math/${filename}.math`);
							xhr.send();
						})
					}));

					var visitedFiles = [filename];

					searchDatabase = [];

					function foo(scope) {
						searchDatabase = searchDatabase
							.concat([...scope.defMap.keys()])
							.concat([...scope.schemaMap.keys()]);
					}

					function bar(scope) {
						for (var [k, s] of scope.importMap) {
							if (visitedFiles.includes(k)) continue;
							visitedFiles.push(k);

							bar(s);
							foo(s);
						}
					}

					bar(program.scope);
					foo(program.scope);

					var end = new Date();
					console.log(program);
					console.log('--- PROGRAM END ---');
					console.log(`Program took ${end - start} ms`);

					generateHtml();
				} finally {
					$('#reload').disabled = false;
					$('#reload svg').classList.remove('rotate');
					reloading = false;
				}
			}

			$('#reload').addEventListener('click', reload);
		</script>
	</body>
</html>